CREATE OR REPLACE TYPE BODY customer_t AS 
  MEMBER FUNCTION timeSpentLooking RETURN INT IS 
  BEGIN 
    RETURN TRUNC(SYSDATE) - dateStarted;
  END timeSpentLooking;
    
  MEMBER FUNCTION timeOwned RETURN INT IS
  BEGIN
    RETURN TRUNC(SYSDATE) - dateOwned;
  END timeOwned;

  MEMBER FUNCTION propertyPreferred RETURN SYS_REFCURSOR IS c SYS_REFCURSOR;
  BEGIN
    OPEN c FOR
      SELECT ac.poid.pid, ac.poid.propertyType
      FROM agentContract ac
      WHERE ac.poid.propertyDetail.listedPrice < ac.scoid.buyerid.pricePreferred * 1.2
      AND ac.coid.cid = SELF.cid;
    RETURN c;
  END propertyPreferred;
END;
/

CREATE OR REPLACE TYPE BODY buyer_t AS
  OVERRIDING MEMBER FUNCTION propertyPreferred RETURN SYS_REFCURSOR IS c SYS_REFCURSOR;
  BEGIN
    OPEN c FOR
      SELECT ac.poid.pid, ac.poid.propertyType, DEREF(ac.scoid).sellerid.pricePreferred
      FROM agentContract ac
      WHERE ac.poid.propertyDetail.listedPrice < DEREF(ac.scoid).buyerid.pricePreferred * 1.2
      AND DEREF(ac.scoid).buyerid.cid = SELF.cid;
    RETURN c;
  END propertyPreferred;
END;
/
--modify for query2 & propertyPreferred

create or replace type body tenant_t as
  OVERRIDING MEMBER FUNCTION propertyPreferred RETURN SYS_REFCURSOR IS c SYS_REFCURSOR;
  BEGIN
    OPEN c FOR
      SELECT ac.poid.pid, ac.poid.propertyType
      FROM agentContract ac
      WHERE ac.poid.propertyDetail.listedPrice < ac.rcoid.tenantid.pricePreferred * 1.2 
      AND ac.rcoid.tenantid.cid = SELF.cid;
    RETURN c;
  END propertyPreferred;
END;
/
-- testing tenant type body:
SELECT t.cid, t.cname, t.propertyPreferred() AS preferred_properties
FROM tenant t WHERE t.cname = 'Oliver Brown';

CREATE OR REPLACE TYPE BODY property_t AS
  MEMBER FUNCTION age RETURN INT IS
  BEGIN
    RETURN EXTRACT(YEAR FROM SYSDATE) - builtYear;
  END age;

  MAP MEMBER FUNCTION propertySize RETURN NUMBER IS
  BEGIN
    RETURN propertyWidth * propertyLength;
  END propertySize;
END;
/
--recreate porperty type body b4 query4
